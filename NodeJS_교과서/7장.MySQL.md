# 07. MySQL
### ë°ì´í„°ë² ì´ìŠ¤ì˜ ë„ì… ë°°ê²½

ê·¸ë™ì•ˆ ëª¨ë“  ë°ì´í„°ë¥¼ ë³€ìˆ˜ì— ì €ì¥í–ˆëŠ”ë°, ì„œë²„ê°€ ì¢…ë£Œë˜ë©´ ë©”ëª¨ë¦¬ê°€ ì •ë¦¬ë˜ë©´ì„œ ì €ì¥í–ˆë˜ ë°ì´í„°ë„ ì‚¬ë¼ì§

â‡’ ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©

## 7.1 ë°ì´í„°ë² ì´ìŠ¤ë€ ?

### ë°ì´í„°ë² ì´ìŠ¤

ê´€ë ¨ì„±ì„ ê°€ì§€ë©° ì¤‘ë³µì´ ì—†ëŠ” ë°ì´í„°ë“¤ì˜ ì§‘í•©

### DBMS

DataBase Manangement System

ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œ

### íŠ¹ì§•

1. ì„œë²„ì˜ í•˜ë“œ ë””ìŠ¤í¬ë‚˜ SSD ë“±ì˜ ì €ì¥ ë§¤ì²´ì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤
2. ì„œë²„ ì¢…ë£Œ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë°ì´í„°ë¥¼ ê³„ì† ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
3. ì—¬ëŸ¬ ì‚¬ëŒì´ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

ì´ë²ˆ ì±•í„°ì—ì„œëŠ” DBMS ì¤‘ì—ì„œ RDBMS ê·¸ë¦¬ê³  ê·¸ ì¤‘ MySQLì„ ë‹¤ë£° ì˜ˆì •

## 7.2 MySQL ì„¤ì¹˜í•˜ê¸°

## 7.3 ì›Œí¬ë²¤ì¹˜ ì„¤ì¹˜í•˜ê¸°

> ì±…ì— ë‚˜ì˜¤ëŠ” brew installë¡œ í•˜ë‹ˆê¹Œ ê³„ì† ì—ëŸ¬ ë– ì„œ ìœ íŠœë¸Œì— ìˆëŠ” ì˜ìƒìœ¼ë¡œ ë¬¸ì œ í•´ê²°
> 

[How to Install MySQL on Mac | Install MySQL on macOS (2024)](https://www.youtube.com/watch?v=ODA3rWfmzg8)

mysql ì ‘ì†

```jsx
mysql -h localhost -u root -p
```

### í…Œì´ë¸” ìƒì„±í•˜ê¸°

users

```sql
CREATE TABLE nodejs.users (
	id INT NOT NULL AUTO_INCREMENT,
	name VARCHAR(20) NOT NULL,
	age INT UNSIGNED NOT NULL,
	married TINYINT NOT NULL,
	comment TEXT NULL,
	created_at DATETIME NOT NULL DEFAULT now(),
	PRIMARY KEY(id),
	UNIQUE INDEX name_UNIQUE (name ASC)
)
COMMENT = 'ì‚¬ìš©ì ì •ë³´'
ENGINE = InnoDB
```

comments

```sql
CREATE TABLE nodejs.comments (
	id INT NOT NULL AUTO_INCREMENT,
	commenter INT NOT NULL,
	comment VARCHAR(100) NOT NULL,
	created_at DATETIME NOT NULL DEFAULT now(),
	PRIMARY KEY(id),
	INDEX commenter_idx (commenter ASC),
	CONSTRAINT commenter
	FOREIGN KEY (commenter)
	REFERENCES nodejs.users (id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
)
COMMENT = 'ëŒ“ê¸€'
ENGINE = InnoDB;
```

### MySQL ìë£Œí˜•

- INT
    - ì •ìˆ˜
    - ì†Œìˆ˜ê¹Œì§€ ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´ FLOAT / DOUBLE ì‚¬ìš©
- VARCHAR(ìë¦¿ìˆ˜)
    - CHAR(ìë¦¿ìˆ˜)ëŠ” ê³ ì •ê¸¸ì´ VARCHARëŠ” ê°€ë³€ê¸¸ì´
- TEXT
    - ê¸´ ê¸€ì„ ì €ì¥í•  ë•Œ ì‚¬ìš©
- TINYINT
    - -128 ~ 127
    - 0 / 1ì„ ì‚¬ìš©í•˜ë©´ booleanì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- DATETIME
    - DATE(ë‚ ì§œì •ë³´ë§Œ) / TIME(ì‹œê°„ì •ë³´ë§Œ)
    - DATETIME â† ë‘˜ ë‹¤
- â€¦

### MySQL ì»¬ëŸ¼ ì˜µì…˜

- NULL / NOT NULL
    - ë¹ˆì¹¸ì„ í—ˆìš©í• ì§€ ì—¬ë¶€
- AUTO_INCREMENT
    - ìˆ«ìë¥¼ ì €ì ˆë¡œ ì˜¬ë¦¼
- UNSIGNED
    - ìˆ«ì ìë£Œí˜•ì— ì ìš© / ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì²˜ëŸ¼ unsigned ì‚¬ìš©
    - ë‹¨, FLOAT / DOUBLEì€ ë¶ˆê°€ëŠ¥
- ZEROFILL
    - ìˆ«ìì˜ ìë¦¿ìˆ˜ ê³ ì •
    - INT(4) â‡’ 0001
- DEFAULT now()
    - ë°ì´í„°ë¥¼ ì•ˆ ë„£ìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì»¬ëŸ¼ì— ê¸°ë¡í•˜ëŠ” ì‹œê°ì´ ìë™ìœ¼ë¡œ ê¸°ë¡
- PRIMARY KEY
    - pk ì„¤ì •
- UNIQUE INDEX
    - í•´ë‹¹ ê°’ì´ ê³ ìœ í•´ì•¼ í•˜ëŠ”ì§€ ì˜µì…˜
    - UNIQUE INDEX name_UNIQUE (name ASC)
        - nameì€ ê³ ìœ í•´ì•¼ í•˜ë©°, ASC ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ê¸°ì–µí•˜ê² ë‹¤. ë‚´ë¦¼ì°¨ìˆœì€ DESC
- FOREIGN KEY
    - ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ì™¸ë˜ í‚¤ ì„¤ì •
    - CONTRAINT [ì œì•½ì¡°ê±´ëª…] FOREIGN KEY [ì»¬ëŸ¼ëª…] REFERENCES [ì°¸ê³ í•˜ëŠ” ì»¬ëŸ¼ëª…]
    - ON UPDATE / ON DELETE CASCADE
        - ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ê±°ë‚˜ ì‚­ì œë˜ë©´ ê·¸ê²ƒê³¼ ì—°ê²°ëœ ëŒ“ê¸€ ì •ë³´ë„ ê°™ì´ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œ

### MySQL í…Œì´ë¸” ì˜µì…˜

- COMMENT
    - í…Œì´ë¸”ì— ëŒ€í•œ ë³´ì¶© ì„¤ëª…
    - í•„ìˆ˜ëŠ” ì•„ë‹˜
- ENGINE
    - MyISAM / InnoDBê°€ ë§ì´ ì‚¬ìš©
    - ì±…ì—ì„œëŠ” InnoDBë§Œ ì‚¬ìš©í•œë‹¤ê³  í•¨

```sql
DROP TABLE users;
```

â‡’ í…Œì´ë¸” ì‚­ì œ

```sql
SHOW TABLES;
```

â‡’ í…Œì´ë¸” ë³´ê¸°

## 7.5 CRUD ì‘ì—…í•˜ê¸°

### CRUDë€ ?

Create / Read / Update / Delete

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë§ì´ ìˆ˜í–‰í•˜ëŠ” ë„¤ ê°€ì§€ ì‘ì—…

### Create (ìƒì„±)

```sql
INSERT INTO nodejs.users (name, age, married, comment) VALUES ('taeyun', 21, 0, 'ì•ˆë…•í•˜ì„¸ìš”');
INSERT INTO nodejs.users (name, age, married, comment) VALUES ('gildong', 30, 1, 'ì•ˆë…•í•˜ì„¸ìš”2');
```

```sql
INSERT INTO nodejs.comments (commenter, comment) VALUES (1, 'taeyunì´ ì‘ì„±í•œ ëŒ“ê¸€');
```

### Read (ì¡°íšŒ)

```sql
SELECT * FROM nodejs.users;
SELECT * FROM nodejs.comments;
```

ì¼ë¶€ ì»¬ëŸ¼ë§Œ ë³´ê¸°

```sql
SELECT name, married FROM nodejs.users;
```

ì¡°ê±´

```sql
SELECT name, age FROM nodejs.users WHERE married = 1 AND age >= 30;
```

```sql
SELECT id, name FROM nodejs.users WHERE married = 0 OR age > 30;
```

ì •ë ¬

```sql
SELECT id, name FROM nodejs.users ORDER BY age DESC;
```

ì¡°íšŒí•  ë¡œìš° ê°œìˆ˜ ì„¤ì •

```sql
SELECT id, name FROM nodejs.users ORDER BY age DESC LIMIT 1;
```

ê±´ë„ˆë›°ê¸°

```sql
SELECT id, name FROM nodejs.users ORDER BY age DESC LIMIT 1 OFFSET 1;
```

â‡’ ë‘ ë²ˆì§¸ê°€ ë³´ì—¬ì¤Œ 1ì€ ë„˜ê¹€(offset)

### Update (ìˆ˜ì •)

```sql
UPDATE nodejs.users SET comment = 'ë°”ê¿€ ë‚´ìš©' WHERE id = 2;
```

### DELETE (ì‚­ì œ)

```sql
DELETE FROM nodejs.users WHERE id = 2;
```

## 7.6 ì‹œí€„ë¼ì´ì¦ˆ ì‚¬ìš©í•˜ê¸°

### ì‹œí€„ë¼ì´ì¦ˆ

ìë°”ìŠ¤í¬ë¦½íŠ¸ ORM ë¼ì´ë¸ŒëŸ¬ë¦¬

### ORM

Object-Reletional Mapping

ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë¦´ë ˆì´ì…˜ì„ ë§¤í•‘í•´ì£¼ëŠ” ë„êµ¬

### ì¥ì 

ìë°”ìŠ¤í¬ë¦½íŠ¸ êµ¬ë¬¸ì„ ì•Œì•„ì„œ SQLë¡œ ë°”ê¿”ì¤Œ â‡’ SQL ì–¸ì–´ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ìë°”ìŠ¤í¬ë¦½íŠ¸ë§Œìœ¼ë¡œ MySQL ì¡°ì‘í•  ìˆ˜ ìˆìŒ

<aside>
ğŸ’¡

ì´ì œ ì‹¤ìŠµ ê´€ë ¨ëœ ì½”ë“œëŠ” `NodeJS_êµê³¼ì„œ/learn-sequelize`ì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ ì±…ì—ì„œëŠ” nunjucksë¥¼ ì‚¬ìš©í•˜ëŠ”ë° FE ê°œë°œ ì¤‘ BEì— ë„ì „í–ˆê¸° ë•Œë¬¸ì— í…œí”Œë¦¿ ì—”ì§„ì´ ì•„ë‹Œ React ì‚¬ìš©.

</aside>

### ê´€ê³„ ì •ì˜í•˜ê¸°

ì‚¬ìš©ì í•œ ëª… â†’ ëŒ“ê¸€ ì—¬ëŸ¬ê°œ ê°€ëŠ¥

ëŒ“ê¸€ í•œ ê°œ â†’ ì—¬ëŸ¬ëª… ì‚¬ìš©ì ë¶ˆê°€ëŠ¥

â‡’ 1 : N ê´€ê³„

- 1 : N
- 1 : 1
- N : N

â‡’ ì„¸ ê°€ì§€ ì¢…ë¥˜ì˜ ê´€ê³„ë“¤ì´ ì¡´ì¬

### 1 : N

User â†’ (hasMany) â†’ Comment

Comment â†’ (belongsTo) â†’ User

### 1 : 1

- hasOne
- belongsTo

```sql
db.User.hasOne(db.Info, { foreignKey: 'UserId', sourceKey: 'id' });
db.Info.belongsTo(db.User, { foreignKey: 'UserId', targetKey: 'id' });
```

### N : N

- belongsToMany

```sql
db.Post.belongsToMany(db.Hashing, { through: 'PostHashing' });
db.Hashing.belongsToMany(db.Post, { through: 'PostHashing' });
```

### ì¿¼ë¦¬ ì•Œì•„ë³´ê¸°

```sql
const { User } = require('../models')
User.create({
	name: 'taeyun',
	age: 21,
	married: false,
	comment: 'ìê¸°ì†Œê°œ'
})
```

### ë°ì´í„° ì¡°íšŒ

```jsx
SELECT * FROM nodejs.users;
User.findAll({});
```

```jsx
SELECT * FROM nodejs.users LIMIT 1;
User.findOne({});
```

```jsx
SELECT name, married FROM nodejs.users;
User.findAll({
	attributes: ['name', 'married']
})
```

```jsx
SELECT name, age FROM nodejs.users WHERE married = 1 AND age > 30;
const { Op } = require('sequelize')
const { User } = require('../models')
User.findAll({
	attributes: ['name', 'age'],
	where: {
		married: true,
		age: { [Op.gt]: 30 }
	}
})
```

- Op.gt(ì´ˆê³¼)
- Op.gte(ì´ìƒ)
- Op.lt(ë¯¸ë§Œ)
- Op.lte(ì´í•˜)
- Op.ne(ê°™ì§€ ì•ŠìŒ)
- Op.or(ë˜ëŠ”)
- Op.in(ë°°ì—´ ìš”ì†Œ ì¤‘ í•˜ë‚˜)
- Op.notIn(ë°°ì—´ ìš”ì†Œì™€ ëª¨ë‘ ë‹¤ë¦„)

```jsx
SELECT id, name FROM users WHERE married = 0 OR age > 30;
const { Op } = require('sequelize')
const { User } = require('../models')
User.findAll({
	attributes: ['id', 'name'],
	where: {
		[Op.or]: [{ married: false0 }, { age: { [Op.gt]: 30 } }],
	}
})
```

```jsx
SELECT id, name FROM users ORDER BY age DESC;
User.findAll({
	attributes: ['id', 'name'],
	order: [['age', 'DESC']] // ì´ì¤‘ë°°ì—´
})
```

```jsx
SELECT id, name FROM users ORDER BY age DESC LIMIT1;
User.findAll({
	attributes: ['id', 'name'],
	order: [['age', 'DESC']],
	limit: 1, // limit ì˜µì…˜ ê°€ëŠ¥
})
```

```jsx
SELECT id, name FROM users ORDER BY age DESC LIMIT 1 OFFSET 1;
User.findAll({
	attributes: ['id', 'name'],
	order: ['age', 'DESC'],
	limit: 1,
	offset: 1,
})
```

### ë°ì´í„° ìˆ˜ì •

```jsx
UPDATE nodejs.users SET comment = 'ë°”ê¿€ ë‚´ìš©' WHERE id = 2;
User.update({
	comment: 'ë°”ê¿€ ë‚´ìš©',
}, {
	where: { id: 2 },
})
```

### ë°ì´í„° ì‚­ì œ

```jsx
DELETE FROM nodejs.users WHERE id = 2;
User.destroy({
	where: { id: 2 },
})
```

### ê´€ê³„ ì¿¼ë¦¬

`findOne` í˜¹ì€ `findAll` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ í”„ë¡œë¯¸ìŠ¤ì˜ ê²°ê³¼ë¡œ ëª¨ë¸ì„ ë°˜í™˜í•¨.

```jsx
const user = await User.findAll({})
console.log(user.nick) // ì‚¬ìš©ì ë‹‰ë„¤ì„
```

```jsx
const user = await User.findOne({
	include: [{
		model: Comment,
	}]
})
console.log(user.Comments) // ì‚¬ìš©ì ëŒ“ê¸€
```

```jsx
const user = await User.findOne({})
const comments = await user.getComments()
console.log(comments) // ì‚¬ìš©ì ëŒ“ê¸€
```

ê´€ê³„ë¥¼ ì„¤ì •í•˜ë©´

- getComments (ì¡°íšŒ)
- setComments (ìˆ˜ì •)
- addComments (ìƒì„±)
- removeComments (ì‚­ì œ)

â‡’ ë™ì‚¬ ë’¤ì— ëª¨ë¸ì˜ ì´ë¦„

- ex ) getëª¨ë¸

```jsx
db.User.hasMany(db.Comment, {
	foreignKey: 'commenter',
	sourceKey: 'id',
	as: 'Answers', // => ëª¨ë¸ì˜ ì´ë¦„ì´ Answersë¡œ ë¼ì„œ getAnswers
})
```

```jsx
const user = await User.findOne({});
const comment1 = await Comment.create()
const comment2 = await Comment.create()
await user.addComment([comment1, comment2]) // ì—¬ëŸ¬ê°œëŠ” ë°°ì—´ë¡œ í•  ìˆ˜ë„ ìˆìŒ.
```

### SQL ì¿¼ë¦¬í•˜ê¸°

```jsx
const [result, metadata] = await sequelize.query('SELECT * FROM comments')
```